{"version":3,"sources":["../../../../../client/components/ProtectedRoutes.tsx","../../../../../client/features/api/course-purchase/route.ts","../../../../../client/features/api/live-session/route.ts","../../../../../client/components/student/MyLearning.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { getUserIdFromToken } from \"@/utils/helpers\";\r\n\r\nconst ProtectedRoutes = ({ children }: { children: React.ReactNode }) => {\r\n  const router = useRouter();\r\n  const userId = getUserIdFromToken();\r\n\r\n  useEffect(() => {\r\n    if (!userId) {\r\n      router.push(\"/login\");\r\n    }\r\n  }, [userId, router]);\r\n\r\n  if (!userId) {\r\n    return null;\r\n  }\r\n\r\n  return <>{children}</>;\r\n};\r\n\r\nexport default ProtectedRoutes;\r\n","import axios from \"axios\";\r\n\r\nconst API_BASE_URL = `${process.env.NEXT_PUBLIC_API_URL}/course-purchase`;\r\n\r\nexport const getCoursedetailWithPurchaseStatus = async (courseId: string, userId?: string) => {\r\n  console.log(\"Fetching course details for:\", API_BASE_URL);\r\n  try {\r\n    const params = userId ? { userId } : {};\r\n    const { data } = await axios.get(`${API_BASE_URL}/${courseId}`, {\r\n      params,\r\n    });\r\n    // Normalize `purchased` based on any purchase record status returned from server.\r\n    // Some backends may return a `coursePurchase` object with a `status` field\r\n    // (eg. 'pending', 'paid', 'failed'). Only treat as purchased when status\r\n    // clearly indicates success.\r\n    let purchasedFlag = !!data?.purchased;\r\n    const status = data?.coursePurchase?.status;\r\n    if (status && typeof status === 'string') {\r\n      const s = status.toLowerCase();\r\n      purchasedFlag = s === 'paid' || s === 'success' || s === 'completed';\r\n    }\r\n\r\n    return { ...data, purchased: purchasedFlag };\r\n  } catch (error) {\r\n    console.error(\"Error fetching course:\", error);\r\n  }\r\n};\r\n\r\nexport const createRazorpayOrder = async (courseId: string) => {\r\n  try {\r\n    const { data } = await axios.post(`${API_BASE_URL}/${courseId}/create-razorpay-order`);\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"Error creating order:\", error);\r\n  }\r\n};\r\n\r\nexport const verifyPayment = async (paymentDetails: {\r\n  razorpay_order_id: string;\r\n  razorpay_payment_id: string;\r\n  razorpay_signature: string;\r\n  userId: string;        // âœ… ADD THIS\r\n  courseId: string;      // âœ… ADD THIS\r\n}) => {\r\n  try {\r\n    console.log(\"ðŸ” Verifying payment with details:\", paymentDetails);\r\n\r\n    const { data } = await axios.post(`${API_BASE_URL}/verify-payment`, paymentDetails);\r\n\r\n    console.log(\"âœ… Payment verification response:\", data);\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"âŒ Error verifying payment:\", error);\r\n    throw error; // âœ… Throw error instead of just logging\r\n  }\r\n}\r\n\r\nexport const fetchPurchasedCourses = async (userId: string) => {\r\n  try {\r\n    const { data } = await axios.get(\r\n      `${API_BASE_URL}/purchased-courses/${userId}`,\r\n    );\r\n    return data;\r\n  } catch (error: any) {\r\n    throw new Error(\r\n      error.response?.data?.message || 'Failed to fetch purchased courses',\r\n    );\r\n  }\r\n};\r\n\r\nexport const enrollIdCourse = async ({ courseId, userId }) => {\r\n  const res = await fetch(\r\n    `${process.env.NEXT_PUBLIC_API_URL}/courses/enroll-student`,\r\n    {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ courseId, userId }),\r\n    }\r\n  );\r\n\r\n  return res.json();\r\n};\r\n\r\n// Admin API functions\r\nexport const getAllPurchasesForAdmin = async () => {\r\n  try {\r\n    const { data } = await axios.get(`${API_BASE_URL}/admin/all-purchases`);\r\n    return data;\r\n  } catch (error: any) {\r\n    throw new Error(\r\n      error.response?.data?.message || 'Failed to fetch purchases',\r\n    );\r\n  }\r\n};\r\n\r\nexport const revokeAccess = async (purchaseId: string) => {\r\n  try {\r\n    const { data } = await axios.post(`${API_BASE_URL}/admin/revoke/${purchaseId}`);\r\n    return data;\r\n  } catch (error: any) {\r\n    throw new Error(\r\n      error.response?.data?.message || 'Failed to revoke access',\r\n    );\r\n  }\r\n};\r\n\r\nexport const restoreAccess = async (purchaseId: string) => {\r\n  try {\r\n    const { data } = await axios.post(`${API_BASE_URL}/admin/restore/${purchaseId}`);\r\n    return data;\r\n  } catch (error: any) {\r\n    throw new Error(\r\n      error.response?.data?.message || 'Failed to restore access',\r\n    );\r\n  }\r\n};\r\n","import axios from 'axios';\r\n\r\nconst API_BASE_URL = `${process.env.NEXT_PUBLIC_API_URL}/live-session`;\r\n\r\nexport const fetchLiveSessions = async () => {\r\n  try {\r\n    const { data } = await axios.get(API_BASE_URL);\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error fetching live sessions:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const createLiveSession = async (sessionData: any) => {\r\n  try {\r\n    const { data } = await axios.post(API_BASE_URL, sessionData);\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error creating live session:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const updateLiveSession = async (id: string, sessionData: any) => {\r\n  try {\r\n    const { data } = await axios.patch(`${API_BASE_URL}/${id}`, sessionData);\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error updating live session:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const deleteLiveSession = async (id: string) => {\r\n  try {\r\n    const { data } = await axios.delete(`${API_BASE_URL}/${id}`);\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error deleting live session:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const createLiveSessionOrder = async (sessionId: string, userId: string) => {\r\n  try {\r\n    const { data } = await axios.post(`${API_BASE_URL}/${sessionId}/create-order`, { userId });\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error creating live session order:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const verifyLiveSessionPayment = async (paymentDetails: any) => {\r\n  try {\r\n    const { data } = await axios.post(`${API_BASE_URL}/verify-payment`, paymentDetails);\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error verifying live session payment:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const fetchEnrolledLiveSessions = async (userId: string) => {\r\n  try {\r\n    const { data } = await axios.get(`${API_BASE_URL}/enrolled/${userId}`);\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error fetching enrolled live sessions:', error);\r\n    throw error;\r\n  }\r\n};\r\n","\"use client\";\r\nimport { useEffect, useState } from 'react';\r\nimport { fetchPurchasedCourses } from '@/features/api/course-purchase/route';\r\nimport { fetchEnrolledLiveSessions } from '@/features/api/live-session/route';\r\nimport { getUserIdFromToken } from '@/utils/helpers';\r\nimport Link from 'next/link';\r\nimport toast from 'react-hot-toast';\r\nimport { Button } from '@/components/ui/button';\r\n\r\ninterface Course {\r\n  _id: string;\r\n  courseTitle: string;\r\n  creator: {\r\n    name: string;\r\n  };\r\n}\r\n\r\ninterface LiveSession {\r\n  _id: string;\r\n  title: string;\r\n  instructor: {\r\n    name: string;\r\n  };\r\n  dateTime: string;\r\n  duration: number;\r\n}\r\n\r\nexport default function MyLearning() {\r\n  const [purchasedCourses, setPurchasedCourses] = useState<Course[]>([]);\r\n  const [enrolledSessions, setEnrolledSessions] = useState<LiveSession[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const userId = getUserIdFromToken();\r\n\r\n  useEffect(() => {\r\n    const getMyLearningData = async () => {\r\n      if (!userId) return;\r\n      try {\r\n        const coursesData = await fetchPurchasedCourses(userId);\r\n        setPurchasedCourses(coursesData.courses);\r\n        const sessionsData = await fetchEnrolledLiveSessions(userId);\r\n        setEnrolledSessions(sessionsData);\r\n      } catch (error) {\r\n        toast.error('Failed to load learning data.');\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    getMyLearningData();\r\n  }, [userId]);\r\n\r\n  if (isLoading) {\r\n    return <div>Loading...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"container mx-auto px-4 sm:px-6 lg:px-8 py-12\">\r\n      <h1 className=\"text-4xl font-extrabold tracking-tight lg:text-5xl text-center mb-12\">\r\n        My Learning\r\n      </h1>\r\n      \r\n      <h2 className=\"text-3xl font-bold mb-6\">My Courses</h2>\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12\">\r\n        {purchasedCourses.map((course) => (\r\n          <div key={course._id} className=\"bg-card dark:bg-gray-800/50 rounded-lg shadow-sm border p-6\">\r\n            <h3 className=\"text-xl font-bold mb-2\">{course.courseTitle}</h3>\r\n            <p className=\"text-muted-foreground mb-4\">by {course.creator.name}</p>\r\n            <Link href={`/course/course-progress/${course._id}`}>\r\n              <Button className=\"w-full\">Go to Course</Button>\r\n            </Link>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <h2 className=\"text-3xl font-bold mb-6\">My Live Sessions</h2>\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\r\n        {enrolledSessions.map((session) => (\r\n          <div key={session._id} className=\"bg-card dark:bg-gray-800/50 rounded-lg shadow-sm border p-6\">\r\n            <h3 className=\"text-xl font-bold mb-2\">{session.title}</h3>\r\n            <p className=\"text-muted-foreground mb-4\">with {session.instructor.name}</p>\r\n            <p><strong>Date & Time:</strong> {new Date(session.dateTime).toLocaleString()}</p>\r\n            <p><strong>Duration:</strong> {session.duration} minutes</p>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}